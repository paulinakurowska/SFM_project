---
title: "Statistics of financial markets"
author: "Paulina Kurowska & Wendy Bingling"
date: "24 listopada 2017"
output: pdf_document
---
Installing packages: fGarch - for Garch simulations
Grid, GridExtra - for displaying the results as a table
```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
if(!require("fGarch")){install.packages("fGarch")};  library(fGarch)
if(!require("grid")){install.packages("grid")};  library(grid)
if(!require("gridExtra")){install.packages("gridExtra")};  library(gridExtra)

```

## Monte Carlo simulations of QMLE of an ARCH(1)
We define the function called 'simulation' which returns the string of:
1.averaged alpha coefficient 
2. standard deviation of the alpha from the true paramater which equals to 0.9
3. quantity of alpha larger or equal to 1
 those were received based on the 1000 replications. This function takes the size of the dataset as an input, it must be a numeric value. The idea is to simulate ARCH (1) model with the conditional distribution defined to be calculated as Quasi Maximum Likelihood Estimation.
Further we apply that function to different size of datasets: 100, 250, 500, 1000

```{r}
set.seed(123)
simulation<-function(size_of_dataset){
  list_alpha<-c()
  h<-c()
  diff<-c()
  for (i in 1:1000) {
    #model<-garchSim(spec = garchSpec(), n = 100, n.start = 100, extended = FALSE)
    modelArch<-garchFit(~garch(1), data = garchSim(spec = garchSpec(model = list(alpha = 0.9, beta = 0)), n=size_of_dataset),cond.dist = "QMLE")
    list_alpha<-c(list_alpha,coef(modelArch)[3])
  }
  for (alpha in list_alpha){
  tmp<-(alpha-0.9)^2
  diff<-c(diff,tmp)
  }
  
  count<-0
  for (alpha in list_alpha){
    if (round(alpha,7)>=1){
    count=count+1
      }
  }
  results<-c(mean=mean(list_alpha),sd=(sum(diff)/length(diff))^0.5, alpha_bigger_or_equal_1=count/length(list_alpha))
  return(results)
}


Dataset100<-simulation(100)
Dataset250<-simulation(250)
Dataset500<-simulation(500)
Dataset1000<-simulation(1000)


```

Taking look at the results
```{r}
Dataset100
Dataset250
Dataset500
Dataset1000
```

Constructing a table which sums up the results

```{r}

rowNames <- c('Dataset100','Dataset250','Dataset500','Dataset1000')
columnNames <- c('average of alpha', 'sd of alpha', 'alpha >= 1')
data <- matrix(NA, length(rowNames),length(columnNames))
               rownames(data)=rowNames
               colnames(data)=columnNames
               data[,]=matrix(1:12,3,4)
data[1,1:3]<-Dataset100[1:3]
data[2,1:3]<-Dataset250[1:3]
data[3,1:3]<-Dataset500[1:3]
data[4,1:3]<-Dataset1000[1:3]

```


Showing and saving the table with the results as a png file
```{r}

fileName <- paste('table',Sys.time(),'.png')
fileName <- gsub('-','_',fileName)
fileName <- gsub(':','',fileName)
png(filename = fileName)
grid.table(data)
dev.off()
```


```{r}
RNGkind(kind = "Knuth-TAOCP-2002", normal.kind = NULL)
Dataset100Knuth<-simulation(100)
Dataset250Knuth<-simulation(250)
Dataset500Knuth<-simulation(500)
Dataset1000Knuth<-simulation(1000)
rowNames <- c('Dataset100','Dataset250','Dataset500','Dataset1000')
columnNames <- c('average of alpha', 'sd of alpha', 'alpha >= 1')
dataRNGKnuth <- matrix(NA, length(rowNames),length(columnNames))
               rownames(dataRNGKnuth)=rowNames
               colnames(dataRNGKnuth)=columnNames
               dataRNGKnuth[,]=matrix(1:12,3,4)
dataRNGKnuth[1,1:3]<-Dataset100Knuth[1:3]
dataRNGKnuth[2,1:3]<-Dataset250Knuth[1:3]
dataRNGKnuth[3,1:3]<-Dataset500Knuth[1:3]
dataRNGKnuth[4,1:3]<-Dataset1000Knuth[1:3]
png(filename = 'Results for Knuth 2002.png')
grid.table(dataRNGKnuth)
dev.off()
```


```{r}
RNGkind(kind = "Wichmann-Hill", normal.kind = NULL)
Dataset100WH<-simulation(100)
Dataset250WH<-simulation(250)
Dataset500WH<-simulation(500)
Dataset1000WH<-simulation(1000)
rowNames <- c('Dataset100','Dataset250','Dataset500','Dataset1000')
columnNames <- c('average of alpha', 'sd of alpha', 'alpha >= 1')
dataRNGWH <- matrix(NA, length(rowNames),length(columnNames))
               rownames(dataRNGWH)=rowNames
               colnames(dataRNGWH)=columnNames
               dataRNGWH[,]=matrix(1:12,3,4)
dataRNGWH[1,1:3]<-Dataset100WH[1:3]
dataRNGWH[2,1:3]<-Dataset250WH[1:3]
dataRNGWH[3,1:3]<-Dataset500WH[1:3]
dataRNGWH[4,1:3]<-Dataset1000WH[1:3]
png(filename = 'Results for Wichmann Hill.png')
grid.table(dataRNGWH)
dev.off()
```

